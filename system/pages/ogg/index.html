<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>VOGGR5 - ogg file conversion tool</title>
<link rel="shortcut icon" type="image/png" href="https://raw.githubusercontent.com/mcmattyobriore/vslicr5/main/system/icons/favicon.png">
<style>
  /* MATCHING YOUR INDEX CSS */
  * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
  body { font-family: Arial, sans-serif; background: #111; color: #eee; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
  .logo-container { width: 100%; display: flex; justify-content: center; margin-bottom: 20px; }
  .logo-container img { width: 120px; height: 120px; image-rendering: pixelated; object-fit: contain; }
  .main-content { display: flex; flex-direction: column; width: 100%; max-width: 600px; gap: 12px; background: #1e1e1e; padding: 20px; border: 1px solid #444; border-radius: 8px; }
  .status-box { width: 100%; height: 80px; background: #000; color: #0f0; border: 1px solid #444; padding: 8px; font-family: monospace; font-size: 11px; overflow-y: auto; }
  .progress-container { width: 100%; height: 8px; background: #333; border-radius: 4px; overflow: hidden; display: none; }
  #progressBar { width: 0%; height: 100%; background: #0f0; transition: width 0.2s; }
  .row { display: flex; gap: 10px; align-items: center; justify-content: center; margin-top: 10px; }
  button, .upload-btn { padding: 12px 20px; background: #222; color: #fff; border: 1px solid #555; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 11px; }
  button:active { background: #444; }
  #downloadLink { display: none; color: #000; background: #00f2ff; text-decoration: none; padding: 15px; text-align: center; border-radius: 6px; font-weight: bold; margin-top: 10px; }
</style>
</head>
<body>

<div class="logo-container"><img src="https://raw.githubusercontent.com/mcmattyobriore/vslicr5/main/system/icons/logo.png" alt="VslicR5"></div>

<div class="main-content">
  <h2 style="margin:0; text-align:center; color:#0f0; font-size: 16px;">FAST OGG CONVERTER</h2>
  <div class="status-box" id="log">Ready. Select a file to start.</div>
  <div class="progress-container" id="progCont"><div id="progressBar"></div></div>
  <div class="row">
    <label class="upload-btn">SELECT FILE<input type="file" id="fileInput" accept="audio/*,video/*" hidden /></label>
    <button id="convertBtn">CONVERT</button>
  </div>
      <a href="https://mcmattyobriore.github.io./vslicr5/index.html">Return?</a>
  <a id="downloadLink">DOWNLOAD OGG</a>
</div>

<script src="unpkg.com"></script>

<script>
  const logEl = document.getElementById('log');
  const convertBtn = document.getElementById('convertBtn');
  const fileInput = document.getElementById('fileInput');
  const downloadLink = document.getElementById('downloadLink');
  const progressBar = document.getElementById('progressBar');
  
  let ffmpeg = null;

  function updateLog(msg) {
    logEl.innerHTML = `<div>> ${msg}</div>` + logEl.innerHTML;
  }

  // NEW: Detect when a file is uploaded
  fileInput.onchange = () => {
    const file = fileInput.files[0];
    if (file) {
      // Clear old state
      downloadLink.style.display = 'none';
      document.getElementById('progCont').style.display = 'none';
      progressBar.style.width = '0%';
      
      // Show readiness
      updateLog(`<span style="color:#00f2ff">(${file.name}) is ready to convert</span>`);
    }
  };

  async function initFFmpeg() {
    if (ffmpeg) return;
    updateLog("Loading heavy engine (required for video)...");
    ffmpeg = FFmpeg.createFFmpeg({ log: false });
    await ffmpeg.load();
    updateLog("Engine Ready.");
  }

  convertBtn.onclick = async () => {
    const file = fileInput.files[0];
    if (!file) return alert("Select a file first!");

    const isVideo = file.type.includes('video');
    document.getElementById('progCont').style.display = 'block';
    downloadLink.style.display = 'none';

    if (isVideo) {
      await initFFmpeg();
      updateLog("Processing video...");
      ffmpeg.FS('writeFile', 'input', await FFmpeg.fetchFile(file));
      ffmpeg.setProgress(({ ratio }) => progressBar.style.width = (ratio * 100) + '%');
      await ffmpeg.run('-i', 'input', '-vn', '-c:a', 'libvorbis', 'out.ogg');
      const data = ffmpeg.FS('readFile', 'out.ogg');
      showDownload(data.buffer, file.name);
    } else {
      updateLog("Fast-converting audio...");
      progressBar.style.width = '50%';
      const reader = new FileReader();
      reader.onload = async (e) => {
        showDownload(e.target.result, file.name);
        progressBar.style.width = '100%';
      };
      reader.readAsArrayBuffer(file);
    }
  };

  function showDownload(buffer, originalName) {
    const blob = new Blob([buffer], { type: 'audio/ogg' });
    const url = URL.createObjectURL(blob);
    const baseName = originalName.substring(0, originalName.lastIndexOf('.')) || originalName;
    downloadLink.href = url;
    downloadLink.download = `${baseName}.ogg`;
    downloadLink.style.display = 'block';
    updateLog("DONE! Click download below.");
  }
</script>
</body>
</html>
