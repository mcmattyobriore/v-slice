<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Frames ‚Üí GIF Converter</title>

<style>
body {
  margin:0;
  padding:10px;
  background:#111;
  color:#0f0;
  font-family:monospace;
}
h3 { text-align:center; margin:6px 0; }
.panel {
  max-width:520px;
  margin:auto;
  background:#1b1b1b;
  border:1px solid #444;
  padding:10px;
}
label {
  display:block;
  background:#222;
  border:1px solid #555;
  padding:8px;
  margin-bottom:6px;
  text-align:center;
  cursor:pointer;
}
canvas {
  display:block;
  margin:10px auto;
  background:#000;
  border:1px solid #555;
  image-rendering:pixelated;
}
.controls { display:flex; justify-content:center; gap:6px; flex-wrap:wrap; }
button { background:#222; border:1px solid #555; color:#fff; padding:6px 10px; }
input[type="number"] { width:60px; margin-left:6px; }
</style>
</head>

<body>

<h3>Frames ‚Üí GIF Converter</h3>

<div class="panel">
  <label>Upload PNG Frames (multiple)
    <input hidden type="file" accept="image/png" multiple onchange="loadFrames(this)">
  </label>

  <canvas id="canvas" width="400" height="400"></canvas>

  <div class="controls">
    <label>FPS: <input type="number" id="fpsInput" value="12" min="1" max="60"></label>
    <button onclick="play()">‚ñ∂ Play</button>
    <button onclick="pause()">‚è∏ Pause</button>
    <button onclick="prev()">‚üµ</button>
    <button onclick="next()">‚ü∂</button>
    <button onclick="exportGIF()">üíæ Export GIF</button>
  </div>

  <div id="info">Frames: 0 | Current: 0</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/gif.js.optimized/dist/gif.worker.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gif.js.optimized/dist/gif.js"></script>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let frameImages = [];
let frameIndex = 0;
let playing = false;
let fps = 12;
let lastTime = 0;

/* ---------- LOAD FRAMES ---------- */
function loadFrames(input){
  frameImages = [];
  frameIndex = 0;
  const files = Array.from(input.files).sort((a,b)=>a.name.localeCompare(b.name));
  
  files.forEach(file => {
    const img = new Image();
    img.onload = () => {
      frameImages.push(img);
      draw();
      updateInfo();
    };
    img.src = URL.createObjectURL(file);
  });
}

/* ---------- DRAW ---------- */
function draw(){
  if(!frameImages.length) return;
  const img = frameImages[frameIndex];
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // center image
  const cx = (canvas.width - img.width)/2;
  const cy = (canvas.height - img.height)/2;
  ctx.drawImage(img, cx, cy);
  updateInfo();
}

/* ---------- LOOP ---------- */
function loop(time){
  if(playing && time - lastTime > 1000/fps){
    frameIndex = (frameIndex +1) % frameImages.length;
    draw();
    lastTime = time;
  }
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ---------- CONTROLS ---------- */
function play(){ playing=true; }
function pause(){ playing=false; }
function prev(){ playing=false; frameIndex=(frameIndex-1+frameImages.length)%frameImages.length; draw(); }
function next(){ playing=false; frameIndex=(frameIndex+1)%frameImages.length; draw(); }

function updateInfo(){
  document.getElementById("info").textContent = `Frames: ${frameImages.length} | Current: ${frameIndex}`;
  fps = parseInt(document.getElementById("fpsInput").value) || 12;
}

/* ---------- EXPORT GIF ---------- */
function exportGIF(){
  if(!frameImages.length) return alert("Upload frames first!");

  const gif = new GIF({workers:2, quality:10, width:canvas.width, height:canvas.height});

  frameImages.forEach(img=>{
    const tmpCanvas = document.createElement("canvas");
    tmpCanvas.width = canvas.width;
    tmpCanvas.height = canvas.height;
    const tmpCtx = tmpCanvas.getContext("2d");
    const cx = (tmpCanvas.width - img.width)/2;
    const cy = (tmpCanvas.height - img.height)/2;
    tmpCtx.drawImage(img, cx, cy);
    gif.addFrame(tmpCtx, {copy:true, delay:1000/fps});
  });

  gif.on('finished', blob=>{
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "animation.gif";
    a.click();
    URL.revokeObjectURL(url);
  });

  gif.render();
}
</script>

</body>
</html>
